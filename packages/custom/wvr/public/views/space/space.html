<div data-ng-controller="SpaceDetailController" data-wvr-signaling data-wvr-space>

  <div id="space" data-ng-model="space" class="container">
    <div class="row stdbkg">
      <div class="col-lg-12">
        <span >
          <label class="textLgWL" style="font-size: 23px;">{{space.uuid}}</label>&nbsp;
        </span>
        <span data-ng-show="!space.owner">
            <a data-ng-show="!loginUser._id" href="/auth/login" class="btn btnIptSmOR badge">Own</a>
            <button data-ng-show="loginUser._id" data-ng-click="ownSpace(space)" class="btn btnIptSmOR badge">Own</button>
        </span>
        <span><button id="action-button" class="btn btnIptSmOR badge">Welcome</button></span>
      </div>
    </div>
    <br>

    <div class="row">
      <div class="col-lg-9">
        <p data-ng-show="operationInfo" class="{{alertStyle}}">{{operationInfo}}</p>
      </div>
    </div>

    <div data-ng-show="space.visible" class="row">

      <div class="row">
        <div class="col-lg-12">
          <span class="pull-right"><button class="btn btnIptSmBL" ng-click="toggleScreen()">Screen Toggle</button></span>&nbsp;
          <span class="pull-right" data-ng-show="isSpaceOwner">
            <button class="btn btnIptSmBL" ng-click="toggleDesignPanel()">Design Toggle</button>&nbsp;
          </span>
        </div>
      </div>
      <br>

      <div class="row">

        <div class="col-lg-9" style="position:relative">

          <div data-ng-show="isSpaceOwner">
            <div pageslide ps-open="designPanelOpen" ps-side="left" ps-custom-top="300px" ps-custom-height="800px" ps-class="wvr-pageslide">
              <h2 style="text-align: center;">Space Design Panel</h2>
              <div style="padding:20px" id="space-design-panel">
                <div class="row">
                  <h3>Facilities:</h3>
                  <hr/>
                  <div data-type="Facility" class="box-masonry" data-ng-repeat="item in designerResources.facilities" data-drag="true" data-jqyoui-options="{revert: 'invalid', helper: 'clone'}" data-ng-model="designerResources.facilities" jqyoui-draggable="{index: {{$index}}, placeholder: 'keep', animate: true}">{{item.type}}</div>
                </div>
                <br/>
                <hr/>
                <div class="row" data-drop="true" data-ng-model="trash" data-jqyoui-options="{accept: '[data-type|=&quot;Facility&quot;]'}" jqyoui-droppable="{multiple:true}">
                  <h3>Trash:</h3>
                  <p><span class="alert-info">Drop stuff here as trash.</span></p>
                  <ul>
                    <li data-type="Facility" data-ng-repeat="item in trash track by $index" data-drag="true" data-jqyoui-options="{revert: 'invalid'}" data-ng-model="trash" jqyoui-draggable="{index: {{$index}}, animate: true}">trash - {{item.name || item}}</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <div data-ng-show="userSearchDisplay">
            <div pageslide ps-open="userSearchDisplay" ps-side="right" ps-custom-top="300px" ps-custom-height="200px" ps-class="wvr-pageslide">
              <form class="well form-search">
                <input type="text" data-ng-model="keywords" class="input-medium search-query" placeholder="Name or Email ...">&nbsp;
                <button type="submit" class="btn-info" data-ng-click="searchUser()">Search</button>
              </form>
              <ul>
                <li data-ng-repeat="resultUser in resultUserList">
                  <a data-ng-dblclick="assignOwner(space, facilityToAssign, resultUser)">{{resultUser.name + ' - ' + resultUser.email}}</a>
                </li>
              </ul>
              <span>&nbsp;&nbsp;&nbsp;<button data-ng-click="hideUserSearch()" class="btn-info">Close</button></span>
            </div>
          </div>

          <div data-ng-show="showScreen">
            <br>
            <!--<button class="btn btnIptSmBL" ng-click="toggleScreen()">Screen Toggle</button>-->
            <div id="screenArea" pageslide ps-open="screenOpen" ps-side="top" ps-size="600px" ps-custom-top="6px" ps-class="wvr-pageslide" ps-container="container">
              <button id="screenActionButton" class="btn btn-info" ng-click="screenAction()" disabled="disabled"></button>
              <div style="padding:20px" id="screenDisplay">
              </div>
            </div>
          </div>

          <div id="container" class="clearfix masonry">

            <div id="ownerPresenceBox" class="box-masonry photo col2 masonry-brick" data-space-type="seat">
              <p><span data-ng-show="space.owner">{{space.owner.name}}</span></p>
              <p id="{{space.owner._id}}">
                <span><a id="{{space.owner.name + '-' + space.owner._id}}" href="/wvr/assets/img/lily.jpeg" title="Lily"><img src="/wvr/assets/img/lily.jpeg" alt="Lily"></a></span>
              </p>
              <p data-ng-show="space.owner" ><span id="{{'seat-' + space.owner._id}}">{{'Seat - Space Owner - ' + space.owner.name}}</span></p>
            </div>

            <div data-type="Facility" data-ng-repeat="facility in space.facilities track by $index" class="box-masonry photo col2 masonry-brick" data-space-type="seat" data-drag="true" data-jqyoui-options="{revert: 'invalid', helper: 'clone'}" data-ng-model="space.facilities" jqyoui-draggable="{index: {{$index}}, animate: true}">
              <p><span id="{{'seat-owner-' + facility._id}}">{{facility.owner.name || facility.owner}}</span>&nbsp;<button data-ng-show="isSpaceOwner" data-ng-click="showUserSearch(facility)">Assign Seat Owner</button></p>
              <p id="{{facility._id}}"></p>
              <p><span id="{{'seat-' + facility._id}}">{{facility.name}}</span></p>
            </div>

          </div>

          <div data-ng-show="designPanelOpen" data-ng-model="newFacilities" data-drop="true" data-jqyoui-options="{accept: '[data-type|=&quot;Facility&quot;]'}" jqyoui-droppable="{multiple:true, onDrop: 'onFacilityDropped', containment: 'position'}">
            <p><span class="alert-info">Drop new facilities here!</span></p>
            <div class="box-masonry photo col2 masonry-brick" data-type="Facility" data-ng-repeat="facility in newFacilities track by $index" data-ng-model="newFacilities" data-drag="true" data-jqyoui-options="{revert: 'invalid', helper: 'clone'}" jqyoui-draggable="{index: {{$index}}, animate: true}">
              <p><span id="{{'seat-' + facilityDroppedTime}}">{{facility.type}}</span></p>
            </div>
          </div>

        </div>

        <div class="col-lg-3">

          <div class="input-group">
            <input id="message-text" class="form-control" type="text" placeholder="Instant Messaging ..."/>
          <span class="input-group-btn">
            <button id="send-msg-btn" class="btn btn-info" disabled="true">Waiting ...</button>
          </span>
          </div>
          <hr />
          <div id="message-area">
            <p>
              <span>To:&nbsp;</span><span data-ng-show="!(imers.size > 0)">All</span><span data-ng-repeat="imer in imerList">{{imer}}&nbsp;</span>
            </p>
          </div>

        </div>
      </div>

      <script type="text/javascript" src="/wvr/assets/js/mit/masonry.js"></script>
      <script type="text/javascript" src="/wvr/assets/js/mit/lib/socket.io.js"></script>
      <script type="text/javascript" src="/wvr/assets/js/mit/lib/RTCMultiConnection.js"></script>

    </div>

    <div class="row">
      <button class="btn-info" data-ng-show="isSpaceOwner && spaceChanged" data-ng-click="updateSpace()">Update the Space</button>
    </div>

  </div>

</div>